<!DOCTYPE html>
<html>
  <head>
    <title>Pull Request Form</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
    <style>
      html, body {
      display: flex;
      justify-content: center;
      font-family: Roboto, Arial, sans-serif;
      font-size: 15px;
      }
      form {
      border: 5px solid #f1f1f1;
      }
      input[type=text], input[type=email] {
      width: 100%;
      padding: 16px 8px;
      margin: 8px 0;
      display: inline-block;
      border: 1px solid #ccc;
      box-sizing: border-box;
      }
      div#response_message {
        display: none;
        text-align: center;
        background:#eee;
        transition-property: color;
        transition-duration:2s;
        transition-timing-fucntion:ease-in;
    }
      button {
      background-color: #8ebf42;
      color: white;
      padding: 14px 0;
      margin: 10px 0;
      border: none;
      cursor: grabbing;
      width: 100%;
      }
      h1 {
      text-align:center;
      fone-size:18;
      }
      button:hover {
      opacity: 0.8;
      }
      .formcontainer {
      text-align: left;
      margin: 24px 50px 12px;
      }
      .container {
      padding: 16px 0;
      text-align:left;
      }
      span.psw {
      float: right;
      padding-top: 0;
      padding-right: 15px;
      }
      /* Change styles for span on extra small screens */
      @media screen and (max-width: 300px) {
      span.psw {
      display: block;
      float: none;
      }
    
    </style>
  </head>
  <body>
    <form onsubmit = "return onSubmit(event)" method="post" >
      <h1>Pull Request</h1>
      <div class="formcontainer">
      <hr/>
      <div class="container">
        <label for="domain_name"><strong>Shopify Domain</strong></label>
        <input type="text" placeholder="Enter Domain Name" name="store_domain" required>
        <label for="email_id"><strong>Email ID</strong></label>
        <input type="email" placeholder="Enter Email ID" name="run_by" required>
      </div>
        <input type="hidden" value="customer_info"  name="pull_type" /> 
        <input type="hidden" value="address ingestion"  name="reason" /> 
      <button type="submit" >Initiate Pull Request</button>
      <div class="container"  id="response_message" >
      </div>
    </form>
    <script>
     async function onSubmit(e){
        e.preventDefault();
        document.querySelector("#response_message").innerHTML = "Request In Process ..."
        document.querySelector("#response_message").style.display="block";
        const jsonData = {};
        const formData = new FormData(e.target);
        formData.forEach((value, key) => {
          jsonData[key] = value;
      });
        jsonData["start_date"] = "2021-12-31T18:29:29Z";
        jsonData["end_date"] = getCurrentDateTime()
        const requestJson = JSON.stringify(jsonData);
        console.log(requestJson)
        let res = await apiCallRequest(requestJson);
        console.log(res)
        if(res.status == true){ 
          document.querySelector("#response_message").innerHTML = "Request Completed";
          document.querySelector("#response_message").style.color="green";
          resetResponse()
        }else{
          document.querySelector("#response_message").style.color="red";
          document.querySelector("#response_message").innerHTML = "Request Failed";
          resetResponse()
        }
      }




      function getCurrentDateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}Z`;
    }
    
    

    const apiCallRequest = async (data) => {
      try {
          const requestOptions = {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify(data),
          };
  
          const response = await fetch('/formSubmit', requestOptions);
  
          if (response.ok) {
              const responseData = await response.json();
              return responseData
          } else {
              throw new Error('Request failed with status: ' + response.status);
          }
      } catch (error) {
          console.error('An error occurred:', error);
          return error;
      }
  };


    function resetResponse(){
        setTimeout(()=>{
          document.querySelector("#response_message").style.display="none";
        },3000)  
      }


      

    </script>
  </body>
</html>